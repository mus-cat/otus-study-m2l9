# Инициализация системы. Systemd.
## Задание выполнялось с использованием VirtualBox 6.1.40, использовался vagrant с box-образом generic/debian10 (debian 10.13)

## I. Написать service, который будет раз в 30 секунд мониторить лог на предмет наличия ключевого слова (файл лога и ключевое слово должны задаваться в /etc/sysconfig).
Для выполнения задания, были подготовлены 4 файла:  
1. **checklog.sh** - bash-скрипт осуществляющий поиск ключевого слова (`checkWord`) в определенном лог-файле (`logName`). Скрипт располагается в диретокрии **/opt**. Поиск осуществляется в лог-файле который располагатся либо в директории **/var/log**, либо в её поддиректориях.
2. **checklog.conf** - содержит параметры (ключевое слово и имя лог-файла) для работы **checklog.sh**. Располагается в директории **/etc**.
3. **checklog.service** - unit-файл сервиса **Systemd**. При старте сервиса выполняется скрипт **checklog.sh**, настройки (файл **checklog.conf**) связываются со скриптом через параметр `EnvironmentFile`.
4. **checklog.timer** - unit-файл таймера **Systemd**. В качестве тригера для запуска сервиса **checklog.service** используется параметра `OnUnitInactiveSec`.

## II. Из репозитория установить spawn-fcgi и переписать init-скрипт на unit-файл (имя service должно называться так же: spawn-fcgi).
Т.к. задание выполнялось в debian, init-скрипт для spawn-fcgi отсутствует. Но вместе с пакетом устанавливаются документация и скрипты для запуска, за основу был взят скрипт **/usr/share/doc/spawn-fcgi/run-generic** и несколько модифицирован.  
В результате были подготовлены 3 файла:  
1. **spawn-fcgi.sh** - bash-скрипт осуществляющий запуск исполняемого файла **spawn-fcgi**. Скрипт располагается в диретокрии **/opt**.
2. **spawn-fcgi.conf** - содержит параметры (переменные окружения) для работы **spawn-fcgi.sh**. Располагается в директории **/etc**.
3. **spawn-fcgi.service** - unit-файл сервиса **Systemd**. При старте сервиса выполняется скрипт **spawn-fcgi.sh**, настройки (файл **spawn-fcgi.conf**) связываются со скриптом через параметр `EnvironmentFile`.

## III. Дополнить unit-файл httpd (он же apache) возможностью запустить несколько инстансов сервера с разными конфигурационными файлами.
В debian "из коробуи" уже присутствует сервис-шаблон (**apache2@**). Запуск обеспечивается за счёт скрипта **/usr/sbin/apachectl** и создания директорий вида **/etc/apache-<instance_name>**. Дальше работа осуществлялась на **nginx**.  
В результате был подготовлен сервис **nginx@.service** обеспечивающий запуск сервисов на основе шаблона. Раздельная настройка и запуск сервсов достигается за счёт:  
1. Создания отдельных конфигурационных файлов вида **nginx-<instance_name>** в папке **/etc/nginx**.
2. Создания диреторий вида **/etc/nginx/sites-enabled-<instance_name>**. Последнии нужны, т.к. в debian используется схема, при которой настройка (соответствующие конфигурационные параметры) портов, на которых будет слушать сервер задаются в файле **defaults** расположенных в таких директориях.  

## В заключении:
Подготовлены фалы **Vagrantfile** и **makeTask.yml** - осуществляющие создание и подготовку ВМ. Прилагаемые файлы (необходимо разместить в директории вместе с **Vagrantfile** и **makeTask.yml**) располагаются в необходимых местах ВМ, производится дополнительная настройка (сервисы прописываются). В ВМ будут присутствовать следующие рабочие сущности **checklog.timer**, **checklog.service** (в **/var/log/syslog** ищет слово `start`), **spawn-fcgi.service**, **nginx@first.service** и **nginx@first.second**. Два последних сервиса не "переживут" перезагрузку ВМ, для них не выполнялась команда `systemctl enable ...`, тем не менее командой `systemctl enable ...` их можно запустить.
